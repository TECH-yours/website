
function logout()
{
    localStorage.removeItem('token');
    if (window.location.href.includes('user'))
    {
        window.location.replace('/');
    }
}

$(document).ready(function() {
    console.log('ready');

    $('#member').click(function(){
        $('#memberModal').toggle();
    });
    
    $('#login').on('click', function() 
    {
        console.log('login');
        let redirection = '/line/signin';
        window.location.href = redirection;
    });
    
    $('.logout').on('click', function()
    {
        localStorage.removeItem('token');
        window.location.replace('/e-commerence');
    });

    var urlParams = new URLSearchParams(window.location.search);
    var _token = urlParams.get('token');
    if (_token)
    {
        var newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
        history.pushState({}, document.title, newUrl);
        localStorage.setItem('token', _token);
    }

    let token = localStorage.getItem('token');
    if (token)
    {
        ajax('GET', '/api/user', {}, function(a) {
            if (!a.error)
            {
                const data = a.data;
                $('#user_created_at').text(moment(data.created_at).format('YYYY/MM/DD'));
                $('.userName').text(data.username);
                $('.userName').val(data.username);
                $('.user_name').val(data.name);
                $('.userEmail').text(data.email);
                $('.userEmail').val(data.email);
                $('.userPhone').val(data.phone);
                $('.userBirthday').val(data.birthday);
                $('.userPicture').attr('src', data.picture);
                localStorage.setItem('role', data.role);
                if (data.role == 'user')
                {
                    $('.userRole').text('一般會員');
                    $('#upgrade').show();
                }
                else
                {
                    $('.userRole').text('付費會員');
                    $('#upgrade').hide();
                }
                $('.none-member').hide();
                $('.member').show();
            }
            else
            {
                $('.none-member').show();
                $('.member').hide();
            }
        });
    }
});